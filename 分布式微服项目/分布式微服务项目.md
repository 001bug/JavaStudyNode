# 返回分类及其子分类的层级信息
**需求分析**
按照前端的要求 , 返回层级数据
![](assest/Pasted%20image%2020241118235632.png)
每一层都是list数据集,是树型结构.涉及到流式计算和递归操作(这是一个方案)
在设计servlet层的时候考虑用什么数据保存,通过前端的样例数据,可以是List集合装着categoryentity, 但是要再加一个字段表示层级的信息

**细节**
1.返回的数据规范的问题, `R.ok.put("data",Object)`这个"data"到底影响前端的哪个数据信息
实体类和表字段不一致 可用resultMap进行映射处理.也可以用注解
2.在数据库设计的时候要添加表示层级的字段(catLevel)
3.使用list表示层级的数据结构,需要在实体类中写一个list集合,这个集合不能映射到数据库中(效率).
# 逻辑删除和添加信息至数据库
## 逻辑删除家居分类
**需求分析:**
1.考虑实际情况,不能无逻辑的删除.比如在儿子节点的信息还存在的时候,对父节点进行删除操作
2.添加分类也是, 限制用户无节制的进行深度分类,使得后端递归深度太高
3.实现过程中发现的问题, entity类的字段排序会影响发送给前端的展示形式
4.删除的时候要有再次确认的功能

**解决方案**
1.
```js
remove(node, data) { //处理点击删除分类  
  //输出node, data 观察数据的结构  
  console.log("node=>", node, " data=>", data)  
  //这里我们可以参考前面写过的代码来完成删除任务  
  //1. 获取删除的分类的id  
  var ids = [data.id]  
  
  this.$confirm(`是否删除【${data.name}】菜单?`, '提示', {  
    confirmButtonText: '确定',  
    cancelButtonText: '取消',  
    type: 'warning'  
  }).then(() => {  
    //2. 如果点击确认 , 发出请求, 完成删除  
    this.$http({  
      // 请求 url      url: 'http://localhost:9090/commodity/commoditycategory/delete',  
      method: 'post',  
      //发出请求时，携带的数据  
      data: this.$http.adornData(ids, false)  
    }).then(({data}) => { //{data} 是解构了返回数据的data部分  
      //输出  
      //console.log("返回的data= ", data)  
      this.$message({  
        message: '操作成功',  
        type: 'success'  
      })  
      //刷新分类列表  
      this.getCategories()  
      //设置需要展开的菜单  
      this.expandedKey = [node.parent.data.id]  
    })  
  }).catch(() => { //点击取消，就不删除了  
  })  
},
```
先观察一下数据,哪些能抽象成树的层级,添加的时候也一样,哪些数据能决定树的层级
分类控件, 主要看代码. (递归和流式计算)

2.MyBatisPlus逻辑删除的配置
* 先在数据库有Int型的逻辑删除字段,然后再entity对应的字段加上`@TableLogic`
* 在application.yml文件中配置
```xml
global-config:  
  db-config:  
    id-type: auto #配置主键自增  
    logic-delete-value: 0 #逻辑删除值  
    logic-not-delete-value: 1 #逻辑未删除值
```
* 注释配置
* 本质上就是通过`where`条件过滤(sql语句)
## 添加信息至数据库
**需求**: 点击某个Append 超链接, 完成添加子分类信息到数据库/表，并能够按照层级关系展开
显示(如图)
![](assest/Pasted%20image%2020241121101330.png)
需求分析
1.首先要引入弹窗, 从elementui引入.
* 将`<el-dialog>..</el-dialog>`这段代码直接引入到`<template>..</template>` , 然后用`dialogVisible`来表示是否显示,形成弹窗效果
* 写method中的append方法, 弹窗行为. 还有添加信息的行为. 具体看代码
2.在存储信息的过程中是以表单的形式.传到后端. 那么前端也需要有类似于entity的字段来抽象表单
* export default的data数据中category设立初始化字段,在发送信息的时候还是要自己指定,这样只是在写提交数据方式时有提示
```js
data(){
	return {
		category:{
			id: null,
			name: "",
			parentId: 0,
			catLevel: 0,
			isShow: 1,
			icon: "",
			proUnit: "",
			proCount: 0
		}
	}
}
```
3.编写组件方法
* (append方法)搞清楚每一个字段名的来历, 比如它parentId应该来自于当前的id
* (addCategory)